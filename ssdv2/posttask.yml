---
- name: "Wait for Redriva container to be running"
  shell: |
    for i in {1..30}; do
      if docker ps --filter "name={{ pgrole }}" --filter "status=running" | grep -q "{{ pgrole }}"; then
        exit 0
      fi
      sleep 2
    done
    exit 1
  register: container_check
  ignore_errors: yes

- name: "Display setup information"
  debug:
    msg: |
      ï¿½ Redriva dÃ©ployÃ© avec succÃ¨s !
      ================================
      
      ğŸŒ Interface web: http://{{ domain | default(ansible_default_ipv4.address) }}:{{ port | default('8000') }}
      
      ğŸ”§ Configuration :
        - Rendez-vous sur l'interface web pour configurer votre token Real-Debrid
        - Configurez Sonarr/Radarr si nÃ©cessaire
        - La configuration se fait maintenant via l'interface web !
      
      ğŸ“ RÃ©pertoires de donnÃ©es :
        - Config: {{ settings.storage }}/docker/{{ lookup('env','USER') }}/{{ pgrole }}/config
        - Data: {{ settings.storage }}/docker/{{ lookup('env','USER') }}/{{ pgrole }}/data
      
      ğŸ“š Documentation : Consultez le README pour plus d'informations
  when: container_check.rc == 0

- name: "Display error if container failed to start"
  debug:
    msg: |
      âŒ Erreur lors du dÃ©marrage de Redriva
      ====================================
      
      Le container n'a pas pu dÃ©marrer. VÃ©rifiez les logs :
      docker logs {{ pgrole }}
  when: container_check.rc != 0

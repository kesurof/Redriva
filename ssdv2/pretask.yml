---
- name: "Create config directory with proper ownership"
  file:
    path: "{{ settings.storage }}/docker/{{ lookup('env','USER') }}/{{ pgrole }}/config"
    state: directory
    mode: '0755'
    owner: "{{ lookup('env','MYUID') }}"
    group: "{{ lookup('env','MYGID') }}"

- name: "Create data directory with proper ownership"
  file:
    path: "{{ settings.storage }}/docker/{{ lookup('env','USER') }}/{{ pgrole }}/data"
    state: directory
    mode: '0755'
    owner: "{{ lookup('env','MYUID') }}"
    group: "{{ lookup('env','MYGID') }}"

- name: "Ensure config directory is writable"
  file:
    path: "{{ settings.storage }}/docker/{{ lookup('env','USER') }}/{{ pgrole }}/config"
    mode: '0777'
    state: directory

- name: "Ensure data directory is writable"
  file:
    path: "{{ settings.storage }}/docker/{{ lookup('env','USER') }}/{{ pgrole }}/data"
    mode: '0777'
    state: directory

- name: "Display pretask completion"
  debug:
    msg: |
      ‚úÖ Pretasks Redriva termin√©es
      ============================
      
      üìÅ R√©pertoires cr√©√©s:
        - Config: {{ settings.storage }}/docker/{{ lookup('env','USER') }}/{{ pgrole }}/config
        - Data: {{ settings.storage }}/docker/{{ lookup('env','USER') }}/{{ pgrole }}/data
      
      üîê Permissions configur√©es (777 pour √©viter les conflits Docker)
      üåê Configuration se fera via l'interface web au premier d√©marrage !
